import { ActivityStatus, Modality } from "..\type-activities"
import { Level } from "types-chat"
import { ScholarAttendance } from "..\type-activities"
import { Scholar } from "..\..\users\scholar\scholar"

model Chat {
    id             String           @id @default(nanoid(8))
    title          String
    dates          Json
    speaker        ChatSpeaker[]
    spots          Int
    platform       String
    calendarID     String?
    modality       Modality
    activityStatus ActivityStatus
    level          Level
    tempData       ChatsTempData?
    attendance     ChatAttendance[]

    @@index([title, modality, activityStatus, level])
}

model ChatAttendance {
    id            String            @id @default(nanoid(8))
    scholar       Scholar           @relation(fields: [scholarId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    scholarId     String
    workshop      Chat              @relation(fields: [chatId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    chatId        String
    attendance    ScholarAttendance
    justification String?

    @@index([scholarId])
    @@index([chatId])
}

model ChatsTempData {
    id              String  @id @default(nanoid(8))
    chat            Chat    @relation(fields: [chatId], references: [id])
    chatId          String  @unique
    formLink        String?
    meetingLink     String?
    meetingId       String?
    meetingPassword String?
    whatsappLink    String?
}

model ChatSpeaker {
    id        String  @id @default(nanoid(8))
    scholar   Scholar @relation(fields: [scholarId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    scholarId String
    chat      Chat    @relation(fields: [chatId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    chatId    String
    raiting   Int?

    @@index([chatId])
    @@index([scholarId])
}
